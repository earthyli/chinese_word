<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<title>Cantonese Pronunciation Checker - Two Words</title>
<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    padding: 30px;
    background: #f9f9f9;
  }
  #word {
    font-size: 60px;
    margin: 20px;
  }
  button {
    padding: 15px 25px;
    font-size: 20px;
    margin: 10px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
  }
  #startBtn {
    background-color: #4CAF50;
    color: white;
  }
  #nextBtn {
    background-color: #2196F3;
    color: white;
  }
  #feedback {
    font-size: 60px;
    margin-top: 20px;
  }
  #status {
    font-size: 20px;
    margin-top: 15px;
    color: #555;
  }
  #transcript {
    font-size: 24px;
    margin-top: 10px;
    color: #333;
  }
  #instructions {
    margin-top: 20px;
    font-size: 20px;
    color: #444;
    background-color: #fff3cd;
    padding: 15px;
    border-radius: 8px;
    display: inline-block;
    text-align: left;
  }
</style>
</head>
<body>

<h1>廣東話發音練習 - 雙字詞</h1>
<div id="word">學校</div>
<button id="startBtn">🎤 開始錄音</button>
<button id="nextBtn">➡ 下一題</button>

<div id="instructions">
  <b>使用方法：</b><br>
  1. 按「開始錄音」後，清楚讀出上面顯示嘅中文詞語（廣東話發音）。<br>
  2. 系統會檢查你嘅讀音，正確會顯示 ✅ ，錯誤會播放正確讀音。<br>
  3. 按「下一題」換另一個詞語繼續練習。
</div>

<div id="feedback"></div>
<div id="status"></div>
<div id="transcript"></div>

<script>
const words = ["學校", "食飯", "喝水", "寫字", "買嘢", "聽書", "跑步", "睡覺"];
let currentWord = "";
let recognition;
const feedback = document.getElementById("feedback");
const wordDiv = document.getElementById("word");
const statusDiv = document.getElementById("status");
const transcriptDiv = document.getElementById("transcript");

function randomWord() {
  currentWord = words[Math.floor(Math.random() * words.length)];
  wordDiv.textContent = currentWord;
  feedback.textContent = "";
  transcriptDiv.textContent = "";
  statusDiv.textContent = "";
}

document.getElementById("nextBtn").addEventListener("click", randomWord);

document.getElementById("startBtn").addEventListener("click", () => {
  if (!('webkitSpeechRecognition' in window)) {
    alert("你的瀏覽器唔支援語音識別功能。");
    return;
  }

  recognition = new webkitSpeechRecognition();
  recognition.lang = "zh-HK"; // Cantonese (Hong Kong)
  recognition.interimResults = false;
  recognition.maxAlternatives = 1;
  recognition.continuous = false; // stop automatically after result

  statusDiv.textContent = "🎙 正在錄音...";
  feedback.textContent = "";
  transcriptDiv.textContent = "";

  recognition.start();

  recognition.onresult = (event) => {
    const transcript = event.results[event.results.length - 1][0].transcript.trim();
    transcriptDiv.textContent = `你講咗: ${transcript}`;

    if (transcript === currentWord || transcript.startsWith(currentWord.slice(0,2))) {
      feedback.textContent = "✅";
      speak("正確！");
    } else {
      feedback.textContent = "❌";
      speak(`錯誤，正確讀法係 ${currentWord}`);
    }
  };

  recognition.onerror = (event) => {
    statusDiv.textContent = "⚠ 錯誤: " + event.error;
  };

  recognition.onend = () => {
    statusDiv.textContent = "🛑 錄音已停止";
  };
});

function speak(text) {
  const utterance = new SpeechSynthesisUtterance(text);
  utterance.lang = "zh-HK"; // Cantonese (Hong Kong)
  speechSynthesis.speak(utterance);
}

// Initialize with random word
randomWord();
</script>

</body>
</html>
